# Java虚拟机

## JVM内存结构

### 虚拟机栈
- 由栈帧组成，每个栈帧中拥有局部变量表、操作数栈、动态链接、方法出口等信息。

### 本地方法栈
- 与虚拟机栈类似，服务于native方法。

### 程序计数器
- 当前线程所执行的字节码的行号指示器。

### 堆区
- 存放对象实例。
- 分为新生代和老年代。
- 新生代中有Eden、From Survivor、To Survivor三个区。

### 方法区
- 存放已被虚拟机加载的类信息、常量、静态变量等数据。

## 引用

### 强引用
- 最普遍的引用。当内存空间不足时，JVM不会随意回收具有强引用的对象来解决内存不足的问题。

### 软引用
- 当内存空间不足时，JVM会在GC时回收具有软引用的对象。

### 弱引用
- 不论内存空间是否足够，JVM都会在GC时回收具有弱引用的对象。

### 虚引用
- 等同于没有引用，可能在任何时间被回收。
- 用于跟踪对象被回收的活动。

## finalize()
- 当对象没有重写finalize()方法或finalize()方法已被JVM调用过一次时，finalize()不会被执行。

## 垃圾收集算法

### 标记
- 从GC Roots开始向下搜索，生成引用链，标记所有不可达的对象。

### 标记-清除
- 统一回收所有不可达的对象。

### 标记-整理
- 将所有存活的对象向内存的一端移动，并且回收所有不可达的对象。

### 复制
- 将内存分为大小相同的两块，当其中一块内存用完后，将所有存活的对象复制到另一块中，并且回收所有不可达的对象。

## 垃圾回收器

### Serial
- 新生代回收器。
- 使用单线程和复制算法。

### Serial Old
- 老年代回收器。
- 使用单线程和标记-整理算法。

### ParNew
- 新生代回收器。
- 使用多线程和复制算法。

### Parallel Old
- 老年代回收器。
- 使用多线程和标记-整理算法。

### Parallel Scavenge
- 与ParNew类似。
- 高效利用CPU提高吞吐量。

### CMS
- 初始标记：暂停其他线程，标记直接与GC roots连接的对象。
- 并发标记：同时开启用户线程和标记线程，标记可达对象。
- 重新标记：暂停其他线程，修正变动的标记记录。
- 并发清除：同时开启用户线程和GC线程，清除不可达对象。

### G1
